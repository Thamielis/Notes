https://www.get-blog.com/?cat=6

> I really don’t like using tools like Quest for several reasons, primary among them being that it isn’t portable, or installed by default. I started the AD without Quest segment some time ago and I wanted to continue it again, but in a new direction. I think making scripts that can work in the pipeline is a better approach over making functions that port to each new script. That said, I wanted to make a generic AD searcher that could be used without modification for most queries. After I created it, I found that I prefer it over the UI based tools for information gathering purposes, it really is pretty neat.

# Active Directory » Get-Blog : Ryan's PowerShell Blog
I really don’t like using tools like Quest for several reasons, primary among them being that it isn’t portable, or installed by default. I started the AD without Quest segment some time ago and I wanted to continue it again, but in a new direction. I think making scripts that can work in the pipeline is a better approach over making functions that port to each new script. That said, I wanted to make a generic AD searcher that could be used without modification for most queries. After I created it, I found that I prefer it over the UI based tools for information gathering purposes, it really is pretty neat.

Let’s get started!

First, we need to create our variables. As with all of my recent scripts, I have placed all of my variables in the Param block so that I can modify them at run time. I really like this practice since I can now change the way the script works at run time and I can even use “tab complete” to remember what I was thinking if I run the script 7 months from now. Notice that I setup a “default” value for each of these parameters so that it doesn’t need to be provided for the script to run, you are simply modifying the way the script runs with each.

<table><tbody><tr><td data-settings="show"></td><td><div><p><span>Param</span><span>(</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>String</span><span>]</span><span>$ObjectType</span><span> </span><span>=</span><span> </span><span>"*"</span><span>,</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>Parameter</span><span>(</span><span>ValueFromPipeline</span><span>=</span><span>$true</span><span>)</span><span>]</span><span>[</span><span>String</span><span>]</span><span>$SearchTerm</span><span> </span><span>=</span><span> </span><span>"*"</span><span>,</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>String</span><span>]</span><span>$SearchProperty</span><span> </span><span>=</span><span> </span><span>"cn"</span><span>,</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>String</span><span>]</span><span>$SearchOperator</span><span> </span><span>=</span><span> </span><span>"="</span><span>,</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>Array</span><span>]</span><span>$PropertiesToLoad</span></p><p><span>)</span></p></div></td></tr></tbody></table>

Notice that the only value that I have defined as “from the pipeline” is the search term. This is because I think it’s the only thing that might change if it is coming from the pipeline. I don’t think, for instance that you would have a single search string, but then search on different properties. As well, I have forced the “PropertiesToLoad” to be an array. This is because I will use the .count property later, and if only one property is provided then PowerShell will make the variable a string instead of an array of strings. Strings do not have the .count property.

Now, I wanted to script to work in the pipeline, and there are several semantics that must be used to do this “properly” the first is that you have a “begin”, “process” and “end” block. The begin block will be run once, it is where you can setup any persistent objects or other complete environment items. In my case, I don’t want to create a new .NET AD searcher for every single item in the pipeline, the one will serve for everything, so I create it in the “begin” block.

<table><tbody><tr><td data-settings="show"></td><td><div><p><span>Begin</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Searcher</span><span>=</span><span>New-Object</span><span> </span><span>System</span><span>.</span><span>DirectoryServices</span><span>.</span><span>DirectorySearcher</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Searcher</span><span>.</span><span>PageSize</span><span> </span><span>=</span><span> </span>1000</p></div></td></tr></tbody></table>

The page size of the searcher will break the search into chunks returning 1000 objects at a time. The end result of a search with 8000 users is the same, but AD actually limits the number of items that can be returned in a search (by default 1000) so in the background we will perform eight inquiries to get our one return.

Now, I wanted a way get back only certain data. What if I only want to send the name down the pipeline? What if I want a quick way to see users with a logon count of greater than 1000 and their user names? I decided to let the user pass an array of attribute names to be loaded and sent down the pipeline. More on this later, but for now I am going to load them all into the searcher. Again, this is only done once, not for every single item since it’s in the begin block.

<table><tbody><tr><td data-settings="show"></td><td><div><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>If</span><span> </span><span>(</span><span>$PropertiesToLoad</span><span> </span><span>-ne</span><span> </span><span>$Null</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ForEach</span><span> </span><span>(</span><span>$Property</span><span> </span><span>in</span><span> </span><span>$PropertiesToLoad</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Searcher</span><span>.</span><span>PropertiesToLoad</span><span>.</span><span>Add</span><span>(</span><span>$Property</span><span>.</span><span>ToLower</span><span>(</span><span>)</span><span>)</span><span>&nbsp;&nbsp;</span><span>|</span><span> </span><span>Out-Null</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p></div></td></tr></tbody></table>

Now, we can move to the “process” portion of the script. This will get executed for each item that enters the pipeline, or a single time if executing outside of the pipeline.

The first thing that we need to do is setup the search string for the AD object. I am going to base this whole thing off of the parameters we created at the start. Those familiar with AD search string will recognize this. This is also where the heart of the script resides.

<table><tbody><tr><td data-settings="show"></td><td><div><p><span>$Searcher</span><span>.</span><span>Filter</span><span>=</span><span>"(&amp;(objectcategory=$ObjectType($SearchProperty$SearchOperator$SearchTerm))"</span></p><p><span>$Results</span><span>=</span><span>$Searcher</span><span>.</span><span>FindAll</span><span>(</span><span>)</span></p></div></td></tr></tbody></table>

All this does is make a string that makes a typical, quick search. The default value of the parameters would may the string "(&(objectcategory=\*)(cn=\*))" and return every single AD object. Any modification of the parameters narrows it down from there. If the script is executed with –ObjectType user then the string would become "(&(objectcategory=user)(cn=\*))" and return every single user. I think you probably get the idea. The second line simply executes the query and places the results in our variable with the same name.

For the last part of the script, I wanted to format the data for use in the most intelligent way. Basically, depending on what the user provides for the “PropertiesToLoad” parameter we will have the script give a slightly different output. I decided that if the user gave nothing, then we would send the native .NET object that the searcher returns, unmodified. That would allow the most open-ended use of the return down the pipeline because all of the properties are included. If the user gives a single property, then they are probably trying to send a single piece of information down the pipeline, and so we can return a basic array of strings. Finally, if they are providing several, specific pieces, then perhaps they are trying to gather information, and we can make an array of objects with a property for each item requested and provide it, this makes the output compatible with cmdlets like Out-Gridview.

To start off we will see if the user provided input for “PropertiesToLoad” and either show the direct results, or start some post processing. If we are going to start post processing we need to make our array of objects and all associated properties. If there was only one object loaded, we’ll convert the array of objects into an array of strings.

<table><tbody><tr><td data-settings="show"></td><td><div><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>If</span><span> </span><span>(</span><span>$PropertiesToLoad</span><span> </span><span>-ne</span><span> </span><span>$Null</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ForEach</span><span> </span><span>(</span><span>$Result</span><span> </span><span>in</span><span> </span><span>$Results</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span><span> </span><span>=</span><span> </span><span>""</span><span> </span><span>|</span><span> </span><span>Select-Object</span><span> </span><span>$PropertiesToLoad</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ForEach</span><span> </span><span>(</span><span>$Property</span><span> </span><span>in</span><span> </span><span>$PropertiesToLoad</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span><span>.</span><span>$Property</span><span> </span><span>=</span><span> </span><span>[</span><span>STRING</span><span>]</span><span>$Result</span><span>.</span><span>properties</span><span>.</span><span>$</span><span>(</span><span>$Property</span><span>.</span><span>ToLower</span><span>(</span><span>)</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>If</span><span> </span><span>(</span><span>$PropertiesToLoad</span><span>.</span><span>Count</span><span> </span><span>-eq</span><span> </span>1<span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span><span> </span><span>|</span><span> </span><span>%</span><span>{</span><span>$_</span><span>.</span><span>$PropertiesToLoad</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>Else</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>Else</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Results</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p></div></td></tr></tbody></table>

To break it down more in case that’s a bit confusing. The first step is to make an object called Return and give it the properties that the user wants. This is a quick, easy way to do just that.

<table><tbody><tr><td data-settings="show"></td><td><div><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span><span> </span><span>=</span><span> </span><span>""</span><span> </span><span>|</span><span> </span><span>Select-Object</span><span> </span><span>$PropertiesToLoad</span></p></div></td></tr></tbody></table>

Next we will loop through all of the properties that they would like to have and move it from our results to our return object. We have to do this so that we can pick and choose only the items the user wanted. Even though the native .NET result was limited to the properties we told it above, it will always contain certain things like the distinguished name. Making our own object removes those items and allows PowerShell to display it in a pretty manner.

<table><tbody><tr><td data-settings="show"></td><td><div><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>If</span><span> </span><span>(</span><span>$PropertiesToLoad</span><span>.</span><span>Count</span><span> </span><span>-eq</span><span> </span>1<span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span><span> </span><span>|</span><span> </span><span>%</span><span>{</span><span>$_</span><span>.</span><span>$PropertiesToLoad</span><span>}</span></p></div></td></tr></tbody></table>

Here we are checking to see if only one property was provided. If so then we will quickly convert the array of objects into an array of strings. This is the best way I know how to do that. We are simply sending the object down the pipeline and running a ForEach-Object (% is a built-in alias) and printing the property.

If there is more than one property then we will print the whole object.

That’s it. Once you start to play around with the script you will start to see all of the possibilities. The following code block has the entire thing as one with a help block for usage information. This block will make the script compatible with Get-Help as well!

<table><tbody><tr><td data-settings="show"><div><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p><p>64</p><p>65</p><p>66</p><p>67</p><p>68</p><p>69</p><p>70</p><p>71</p><p>72</p><p>73</p><p>74</p><p>75</p><p>76</p><p>77</p><p>78</p><p>79</p><p>80</p><p>81</p><p>82</p><p>83</p><p>84</p><p>85</p><p>86</p><p>87</p><p>88</p><p>89</p><p>90</p><p>91</p><p>92</p><p>93</p><p>94</p><p>95</p></div></td><td><div><p><span>#.Synopsis</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;This is a quick and open-ended Active Directory searcher</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.Description</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;This script will perform an Active directory search based off of the criteria provided.&nbsp;&nbsp;It</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;is capabale of reading items from the pipeline and delivering items to the pipeline.&nbsp;&nbsp;The output</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;format is dependant on parameters provided.</span></p><p><span>#</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;Authored by Ryan Witschger - http://Ryan.Witschger.net</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.PARAMETER ObjectType</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;This is the type of object to search for.&nbsp;&nbsp;Typical valid options are "user" and "computer"; however,</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;it will take any valid entry for "objectCategory".&nbsp;&nbsp;This limits the objects returned to this</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;type.&nbsp;&nbsp;The default for this option is "*" and will search for all objects.</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.PARAMETER SearchTerm</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;This parameter takes the query to search for including wilcards.&nbsp;&nbsp;Examples are "*Ryan*" or "Server1".</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;Any valid AD search term can be accpeted.&nbsp;&nbsp;The default search term is "*" and will search for all objects.</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;This is the only parameter that will be read from th pipeline.</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.PARAMETER SearchProperty</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;The is the property to search against.&nbsp;&nbsp;Examples are "cn" and "whenCreated".&nbsp;&nbsp;This will work for</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;any entry to your AD schema. the default entry is "cn" to allow a search for object names</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.PARAMETER SearchOperator</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;This paramter takes the logical operator to provide with the AD search.&nbsp;&nbsp;Examples are "=", "&lt;=" and "&gt;=".</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;You may use any valid AD search operator here.&nbsp;&nbsp;The default for this entry is "=" and will allow</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;for a wildcard search of a string.</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.PARAMETER PropertiesToLoad</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;A list, comma seperated, or all properties that you would like to return for the objects found.&nbsp;&nbsp;This</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;parameter also determines the type of output for the script.&nbsp;&nbsp;If not provided the default is to return</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;the .NET object typical provided by an AD searcher.&nbsp;&nbsp;A single entry (example "Name") will provide an</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;array of strings with that property.&nbsp;&nbsp;Finally, an array of properties will provide and array of objects</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;with those properties present.&nbsp;&nbsp;This output may be used in the pipeline.</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.EXAMPLE</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;Return all AD objects.</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;./Get-ADObject.ps1</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.EXAMPLE</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;Return all users named Steve.</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;./Get-ADObject.ps1 -ObjectType user -SearchTerm "*Steve*"</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.EXAMPLE</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;Read computers from a file and return thier last logon time.</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;Get-Content c:Computers.txt | Get-ADObject.ps1 -ObjectType computer -SearchProperty name -PropertiesToLoad lastlogon</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#.EXAMPLE</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;Get local user profiles, lookup their AD properties and display them in Out-Gridview</span></p><p><span>#&nbsp;&nbsp;</span></p><p><span>#&nbsp;&nbsp;&nbsp;&nbsp;GCI c:users | % {$_.Name} | .Get-ADObject.ps1 -SearchProperty sAMAccountName -PropertiesToLoad GivenName, ln, initials, whenCreated | Out-Gridview</span></p><p><span>Param</span><span>(</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>String</span><span>]</span><span>$ObjectType</span><span> </span><span>=</span><span> </span><span>"*"</span><span>,</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>Parameter</span><span>(</span><span>ValueFromPipeline</span><span>=</span><span>$true</span><span>)</span><span>]</span><span>[</span><span>String</span><span>]</span><span>$SearchTerm</span><span> </span><span>=</span><span> </span><span>"*"</span><span>,</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>String</span><span>]</span><span>$SearchProperty</span><span> </span><span>=</span><span> </span><span>"cn"</span><span>,</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>String</span><span>]</span><span>$SearchOperator</span><span> </span><span>=</span><span> </span><span>"="</span><span>,</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>[</span><span>Array</span><span>]</span><span>$PropertiesToLoad</span></p><p><span>)</span></p><p><span>Begin</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Searcher</span><span>=</span><span>New-Object</span><span> </span><span>System</span><span>.</span><span>DirectoryServices</span><span>.</span><span>DirectorySearcher</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Searcher</span><span>.</span><span>PageSize</span><span> </span><span>=</span><span> </span>1000</p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>If</span><span> </span><span>(</span><span>$PropertiesToLoad</span><span> </span><span>-ne</span><span> </span><span>$Null</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ForEach</span><span> </span><span>(</span><span>$Property</span><span> </span><span>in</span><span> </span><span>$PropertiesToLoad</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Searcher</span><span>.</span><span>PropertiesToLoad</span><span>.</span><span>Add</span><span>(</span><span>$Property</span><span>.</span><span>ToLower</span><span>(</span><span>)</span><span>)</span><span>&nbsp;&nbsp;</span><span>|</span><span> </span><span>Out-Null</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p><p><span>Process</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Searcher</span><span>.</span><span>Filter</span><span>=</span><span>"(&amp;(objectcategory=$ObjectType)($SearchProperty$SearchOperator$SearchTerm))"</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Results</span><span>=</span><span>$Searcher</span><span>.</span><span>FindAll</span><span>(</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>If</span><span> </span><span>(</span><span>$PropertiesToLoad</span><span> </span><span>-ne</span><span> </span><span>$Null</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ForEach</span><span> </span><span>(</span><span>$Result</span><span> </span><span>in</span><span> </span><span>$Results</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span><span> </span><span>=</span><span> </span><span>""</span><span> </span><span>|</span><span> </span><span>Select-Object</span><span> </span><span>$PropertiesToLoad</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>ForEach</span><span> </span><span>(</span><span>$Property</span><span> </span><span>in</span><span> </span><span>$PropertiesToLoad</span><span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span><span>.</span><span>$Property</span><span> </span><span>=</span><span> </span><span>[</span><span>STRING</span><span>]</span><span>$Result</span><span>.</span><span>properties</span><span>.</span><span>$</span><span>(</span><span>$Property</span><span>.</span><span>ToLower</span><span>(</span><span>)</span><span>)</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>If</span><span> </span><span>(</span><span>$PropertiesToLoad</span><span>.</span><span>Count</span><span> </span><span>-eq</span><span> </span>1<span>)</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span><span> </span><span>|</span><span> </span><span>%</span><span>{</span><span>$_</span><span>.</span><span>$PropertiesToLoad</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>Else</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Return</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span><span>Else</span><span>{</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span>$Results</span></p><p><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span>}</span></p><p><span>}</span></p></div></td></tr></tbody></table>
