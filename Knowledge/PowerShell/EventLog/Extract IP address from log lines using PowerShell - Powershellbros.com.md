![Log lines](Extract%20IP%20address%20from%20log%20lines%20using%20PowerShell%20-%20Powershellbros.com/Log-lines.png)

Recently I had to extract IP Addresses from log file and check their hostnames. The easiest way to get this was using regex pattern in **Select-String** command.

##### Extract IP Address

Lets says that we have a log file which contains lines like:

_AUDIT “2018-06-19 00:14:16.481 GMT+0200” **10.13.11.7** Server01:1812 0 0 “text=Access GRANTED cloudId=pawel.janowicz_

To extract IP Address from it we can use `[Select-String](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/select-string?view=powershell-6)` command with the following regex pattern `"\d{1,3}(\.\d{1,3}){3}"`\>:

<table><tbody><tr><td><p>1</p><p>2</p></td><td><div><p><code>$Line</code> <code>= </code><code>'AUDIT "2018-06-19 00:14:16.481 GMT+0200"&nbsp; 10.13.11.7 Server01:1812 0 0 "text=Access GRANTED cloudId=pawel.janowicz'</code></p><p><code>(</code><code>$Line</code>&nbsp; <code>|&nbsp; </code><code>Select-String</code> <code>-Pattern</code> <code>"\d{1,3}(\.\d{1,3}){3}"</code> <code>-AllMatches</code><code>).Matches.Value</code></p></div></td></tr></tbody></table>

[![Extract IP example](Extract%20IP%20address%20from%20log%20lines%20using%20PowerShell%20-%20Powershellbros.com/Extract-IP-example.png)](https://i1.wp.com/www.powershellbros.com/wp-content/uploads/2018/06/Extract-IP-example.png)

Extract IP example

In addition the same results we can get using this nice `ExtractValidIPAddress` function:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p></td><td><div><p><code>Function</code> <code>ExtractValidIPAddress(</code><code>$String</code><code>){</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$IPregex</code><code>=‘(?&lt;Address&gt;((25[0-5]</code><code>|2</code><code>[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]</code><code>|2</code><code>[0-4][0-9]|[01]?[0-9][0-9]?))’</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code> <code>(</code><code>$String</code> <code>-Match</code> <code>$IPregex</code><code>) {</code><code>$Matches</code><code>.Address}</code></p><p><code>}</code></p><p><code>$Line</code> <code>= </code><code>'AUDIT "2018-06-19 00:14:16.481 GMT+0200"&nbsp; 10.13.11.7 Server01:1812 0 0 "text=Access GRANTED cloudId=pawel.janowicz'</code></p><p><code>ExtractValidIPAddress </code><code>$Line</code></p></div></td></tr></tbody></table>

To check hostname for some specific IP address we can use `nslookup` or `Resolve-DnsName` commands:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p></td><td><div><p><code>nslookup 10.13.11.7</code></p><p><code>(</code><code>Resolve-DnsName</code> <code>10.13.11.7</code> <code>-ErrorAction</code> <code>SilentlyContinue).NAMEHOST</code></p></div></td></tr></tbody></table>

Below you can find script which will scan for log lines started with word **AUDIT**. It will skip all **“0.0.0.0”** IP addresses. Results will be added to **$Results** array and finally they will be filtered to have only unique values:

<table><tbody><tr><td><p>1</p></td><td><div><p><code>$IPUnique</code> <code>= </code><code>$Results</code> <code>| </code><code>Select-Object</code> <code>IPAddress</code> <code>-Unique</code></p></div></td></tr></tbody></table>

Each IP address will be checked using **Resolve-DnsName** command and added to **$Hosts** array. As a results we will get hostname and IP address columns.

##### Final script

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p></td><td><div><p><code>$Results</code> <code>= @()</code></p><p><code>$Hosts</code> <code>= @()&nbsp;&nbsp;&nbsp;</code></p><p><code>$Server</code> <code>= </code><code>"Server01"</code></p><p><code>$LogPath</code> <code>= </code><code>"C:\logs\$Server\logs\server.log"</code>&nbsp;&nbsp;&nbsp;</p><p><code>$Lines</code> <code>=&nbsp; </code><code>Get-Content</code> <code>$LogPath</code> <code>| </code><code>Where-Object</code> <code>{</code><code>$_</code> <code>-match</code> <code>"AUDIT "</code><code>}</code></p><p><code>Foreach</code> <code>(</code><code>$Line</code> <code>in</code> <code>$Lines</code><code>) {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$IP</code> <code>= </code><code>$Object1</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$IP</code> <code>= (</code><code>$Line</code>&nbsp; <code>|&nbsp; </code><code>Select-String</code> <code>-Pattern</code> <code>"\d{1,3}(\.\d{1,3}){3}"</code> <code>-AllMatches</code><code>).Matches.Value</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>IF</code><code>(</code><code>$IP</code> <code>-notmatch</code> <code>"0.0.0.0"</code><code>){</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object1</code> <code>= </code><code>New-Object</code> <code>PSObject</code> <code>-Property</code> <code>@{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>IPAddress = </code><code>$IP</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Results</code> <code>+= </code><code>$Object1</code>&nbsp;&nbsp;&nbsp;</p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p><p><code>$IPUnique</code> <code>= </code><code>$Results</code> <code>| </code><code>Select-Object</code> <code>IPAddress</code> <code>-Unique</code></p><p><code>Foreach</code> <code>(</code><code>$Item</code> <code>in</code> <code>$IPUnique</code><code>) {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$HostName</code> <code>= </code><code>$Object2</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$HostName</code> <code>= (</code><code>Resolve-DnsName</code> <code>$Item</code><code>.IPAddress</code> <code>-ErrorAction</code> <code>SilentlyContinue).NAMEHOST</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(!</code><code>$HostName</code><code>){</code><code>$Hostname</code> <code>= </code><code>"None"</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object2</code> <code>= </code><code>New-Object</code> <code>PSObject</code> <code>-Property</code> <code>@{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>IPAddress = </code><code>$item</code><code>.ipaddress</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>NameHost&nbsp; = </code><code>$HostName</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Hosts</code> <code>+= </code><code>$Object2</code>&nbsp;&nbsp;&nbsp;</p><p><code>}</code></p><p><code>$Hosts</code> <code>| </code><code>Out-GridView</code> <code>-Title</code> <code>"Hostnames"</code></p></div></td></tr></tbody></table>

In one of the previous articles you can check also [how to get IP address easily using PowerShell](http://www.powershellbros.com/powershell-tip-of-the-week-get-ip-address/).