<!DOCTYPE html>
<html>
<head>
<title>Windows 10 1809 kiosk mode with an AD domain account.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/*!
  Theme: GitHub Dark
  Description: Dark theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-dark
  Current colors taken from GitHub's CSS
*/

.hljs {
  color: #c9d1d9;
  background: #0d1117;
}

.hljs-doctag,
.hljs-keyword,
.hljs-meta .hljs-keyword,
.hljs-template-tag,
.hljs-template-variable,
.hljs-type,
.hljs-variable.language_ {
  /* prettylights-syntax-keyword */
  color: #ff7b72;
}

.hljs-title,
.hljs-title.class_,
.hljs-title.class_.inherited__,
.hljs-title.function_ {
  /* prettylights-syntax-entity */
  color: #d2a8ff;
}

.hljs-attr,
.hljs-attribute,
.hljs-literal,
.hljs-meta,
.hljs-number,
.hljs-operator,
.hljs-variable,
.hljs-selector-attr,
.hljs-selector-class,
.hljs-selector-id {
  /* prettylights-syntax-constant */
  color: #79c0ff;
}

.hljs-regexp,
.hljs-string,
.hljs-meta .hljs-string {
  /* prettylights-syntax-string */
  color: #a5d6ff;
}

.hljs-built_in,
.hljs-symbol {
  /* prettylights-syntax-variable */
  color: #ffa657;
}

.hljs-comment,
.hljs-code,
.hljs-formula {
  /* prettylights-syntax-comment */
  color: #8b949e;
}

.hljs-name,
.hljs-quote,
.hljs-selector-tag,
.hljs-selector-pseudo {
  /* prettylights-syntax-entity-tag */
  color: #7ee787;
}

.hljs-subst {
  /* prettylights-syntax-storage-modifier-import */
  color: #c9d1d9;
}

.hljs-section {
  /* prettylights-syntax-markup-heading */
  color: #1f6feb;
  font-weight: bold;
}

.hljs-bullet {
  /* prettylights-syntax-markup-list */
  color: #f2cc60;
}

.hljs-emphasis {
  /* prettylights-syntax-markup-italic */
  color: #c9d1d9;
  font-style: italic;
}

.hljs-strong {
  /* prettylights-syntax-markup-bold */
  color: #c9d1d9;
  font-weight: bold;
}

.hljs-addition {
  /* prettylights-syntax-markup-inserted */
  color: #aff5b4;
  background-color: #033a16;
}

.hljs-deletion {
  /* prettylights-syntax-markup-deleted */
  color: #ffdcd7;
  background-color: #67060c;
}

.hljs-char.escape_,
.hljs-link,
.hljs-params,
.hljs-property,
.hljs-punctuation,
.hljs-tag {
  /* purposely ignored */
}

</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>
<link rel="stylesheet" href="file://term08/c%24/ProgramData/UniversalAutomation/Repository/KnowledgeBase/styles/github-markdown.css" type="text/css"><link rel="stylesheet" href="file://term08/c%24/ProgramData/UniversalAutomation/Repository/KnowledgeBase/styles/markdown.css" type="text/css">
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body class="vscode-body vscode-dark">
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
  <div class="github-markdown-body github-markdown-auto">
    <div class="github-markdown-content">
      <h1 id="windows-10-1809-kiosk-mode-with-an-ad-domain-account">Windows 10 1809 kiosk mode with an AD domain account</h1>
<p>One of the great new features in Windows 10 1809 is that Microsoft Edge now supports kiosk mode. It is extremely easy to configure and long awaited, so we don't have to use Internet Explorer or Google Chrome for our kiosk computers.</p>
<p>Contents</p>
<!-- vscode-markdown-toc -->
<ul>
<li><a href="#windows-10-1809-kiosk-mode-with-an-ad-domain-account">Windows 10 1809 kiosk mode with an AD domain account</a>
<ul>
<li><a href="#1-configure-edge-for-kioskassigned-access-with-a-local-account">1. Configure Edge for kiosk/assigned access with a local account</a></li>
<li><a href="#2-configure-edge-kioskassigned-access-with-an-ad-domain-account">2. Configure Edge kiosk/assigned access with an AD domain account</a></li>
<li><a href="#3-configure-microsoft-edge-using-group-policy">3. Configure Microsoft Edge using Group Policy</a></li>
<li><a href="#4-configure-autologon-using-group-policy-preferences">4. Configure autologon using Group Policy Preferences</a></li>
<li><a href="#5-deployment-with-a-configuration-manager-task-sequence">5. Deployment with a Configuration Manager task sequence</a></li>
<li><a href="#6-subscribe-to-4sysops-newsletter">6. Subscribe to 4sysops newsletter!</a></li>
</ul>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<h2 id="vscode-markdown-toc"><!-- /vscode-markdown-toc --></h2>
<p>Setting up Windows 10 1809 in kiosk mode using Intune is really easy and beautiful. If you have the chance, be sure to test it out. The kiosk mode in Microsoft Edge is great. We can configure a reset after idle time and configure the behavior of Microsoft Edge in kiosk, single, or multi-app mode. An example might look like the screenshot below:</p>
<p><img src="https://4sysops.com/wp-content/uploads/2018/11/Microsoft-Edge-in-kiosk-mode-600x451.png" alt="Microsoft Edge in kiosk mode"></p>
<p>Microsoft Edge in kiosk mode</p>
<h2 id="1-a-nameconfigureedgeforkioskassignedaccesswithalocalaccountaconfigure-edge-for-kioskassigned-access-with-a-local-account">1. <a name='ConfigureEdgeforkioskassignedaccesswithalocalaccount'></a>Configure Edge for kiosk/assigned access with a local account</h2>
<p>I recommend a local account when using Windows 10 in kiosk/assigned access so you don't expose domain credentials. To do this (during operating system deployment using Configuration Manager for instance) we can simply run a PowerShell script:</p>
<pre class="hljs"><code><div><span class="hljs-variable">$usrname</span> = <span class="hljs-string">'Kiosk'</span>
<span class="hljs-variable">$PlainPassword</span> = <span class="hljs-string">"Kiosk0!234"</span>
<span class="hljs-variable">$SecurePassword</span> = <span class="hljs-variable">$PlainPassword</span> | <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-literal">-AsPlainText</span>  Force
<span class="hljs-built_in">New-LocalUser</span> <span class="hljs-literal">-Name</span> Kiosk <span class="hljs-literal">-Password</span> <span class="hljs-variable">$SecurePassword</span> <span class="hljs-literal">-PasswordNeverExpires</span>  <span class="hljs-literal">-UserMayNotChangePassword</span>
<span class="hljs-built_in">Set-AssignedAccess</span> <span class="hljs-literal">-AppUserModelId</span> Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge <span class="hljs-literal">-UserName</span> <span class="hljs-variable">$usrname</span>
</div></code></pre>
<p>The script performs these actions:</p>
<ol>
<li>Creates a local user named &quot;Kiosk&quot;</li>
<li>Sets a password for that user</li>
<li>Configures Microsoft Edge to run in kiosk/assigned access for the local user named &quot;Kiosk&quot;</li>
</ol>
<h2 id="2-a-nameconfigureedgekioskassignedaccesswithanaddomainaccountaconfigure-edge-kioskassigned-access-with-an-ad-domain-account">2. <a name='ConfigureEdgekioskassignedaccesswithanADdomainaccount'></a>Configure Edge kiosk/assigned access with an AD domain account</h2>
<p>This is really easy, but if we want to want to use a domain account, it becomes much harder, since we can't use the built-in PowerShell command to configure assigned access for just that domain account. However, we have the PowerShell WMI Bridge.</p>
<p>The PowerShell script below will use the PowerShell WMI Bridge to configure Microsoft Edge for &quot;User1&quot; in the &quot;CCMEXEC&quot; domain. Note: The script must be executed in System context.</p>
<pre class="hljs"><code><div><span class="hljs-variable">$LogonDomain</span> = <span class="hljs-string">"CCMEXEC"</span>
<span class="hljs-variable">$User</span> = <span class="hljs-string">"Kiosk"</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Set-KioskMode</span></span> {
    <span class="hljs-keyword">param</span>(
        [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$Domain</span>,
        [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$UserName</span>
    )
    
    <span class="hljs-variable">$User</span> = <span class="hljs-string">"<span class="hljs-variable">$</span>(<span class="hljs-variable">$Domain</span>)\<span class="hljs-variable">$</span>(<span class="hljs-variable">$UserName</span>)"</span>.TrimStart(<span class="hljs-string">'\'</span>)
    
    <span class="hljs-variable">$nameSpaceName</span>=<span class="hljs-string">"root\cimv2\mdm\dmmap"</span>
    <span class="hljs-variable">$className</span>=<span class="hljs-string">"MDM_AssignedAccess"</span>
    <span class="hljs-variable">$obj</span> = <span class="hljs-built_in">Get-CimInstance</span> <span class="hljs-literal">-Namespace</span> <span class="hljs-variable">$namespaceName</span> <span class="hljs-literal">-ClassName</span> <span class="hljs-variable">$className</span>
    
    <span class="hljs-variable">$obj</span>.Configuration = <span class="hljs-string">@"
    &lt;?xml version="1.0" encoding="utf-8" ?&gt;
    &lt;AssignedAccessConfiguration
        xmlns="http://schemas.microsoft.com/AssignedAccess/2017/config"
        xmlns:rs5="http://schemas.microsoft.com/AssignedAccess/201810/config"
        &gt;
        &lt;Profiles&gt;
            &lt;Profile Id="{AFF9DA33-AE89-4039-B646-3A5706E92957}"&gt;
                &lt;KioskModeApp AppUserModelId="Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge"/&gt;
            &lt;/Profile&gt;
        &lt;/Profiles&gt;
        &lt;Configs&gt;
            &lt;Config&gt;
                &lt;Account&gt;<span class="hljs-variable">$</span>(<span class="hljs-variable">$User</span>)&lt;/Account&gt;
                &lt;DefaultProfile Id="{AFF9DA33-AE89-4039-B646-3A5706E92957}"/&gt;
            &lt;/Config&gt;
        &lt;/Configs&gt;
    &lt;/AssignedAccessConfiguration&gt;
"@</span>
    
    <span class="hljs-built_in">Set-CimInstance</span> <span class="hljs-literal">-CimInstance</span> <span class="hljs-variable">$obj</span>
}

<span class="hljs-built_in">Set-KioskMode</span> <span class="hljs-literal">-Domain</span> <span class="hljs-variable">$LogonDomain</span> <span class="hljs-literal">-UserName</span> <span class="hljs-variable">$User</span>
</div></code></pre>
<h2 id="3-a-nameconfiguremicrosoftedgeusinggrouppolicyaconfigure-microsoft-edge-using-group-policy">3. <a name='ConfigureMicrosoftEdgeusingGroupPolicy'></a>Configure Microsoft Edge using Group Policy</h2>
<p>Windows 10 1809 introduces new Microsoft Edge Group Policies we can use to configure Microsoft Edge in kiosk mode. Here are the Group Policies I have configured in my example.</p>
<p><img src="https://4sysops.com/wp-content/uploads/2018/11/Microsoft-Edge-Group-Policy-settings-600x160.png" alt="Microsoft Edge Group Policy settings"></p>
<p>The two new settings are &quot;Configure kiosk mode&quot; and &quot;Configure kiosk reset after idle timeout&quot; where we configure the use of Microsoft Edge in multi-app mode or single-app mode and the idle timeout before it refreshes the session. I use the &quot;Configure Start pages&quot; Group Policy to set the start page for the kiosk as well. It's really simple.</p>
<p><img src="https://4sysops.com/wp-content/uploads/2018/11/Configuring-kiosk-mode.png" alt="Configuring kiosk mode"></p>
<p>And this is the policy that sets the idle timeout:</p>
<p><img src="https://4sysops.com/wp-content/uploads/2018/11/Setting-the-timeout-limit.png" alt="Setting the timeout limit"></p>
<h2 id="4-a-nameconfigureautologonusinggrouppolicypreferencesaconfigure-autologon-using-group-policy-preferences">4. <a name='ConfigureautologonusingGroupPolicyPreferences'></a>Configure autologon using Group Policy Preferences</h2>
<p>I prefer to configure autologon using Group Policy Preferences, so you can easily change the password. You could configure it during operating system deployment as well of course or by using a script. I have two different organizational units (OUs): one for the kiosk with the local logon and one for computers for the domain account to log onto. We could filter this using security groups as well, but the functionality is the same, and I use the same Group Policy Object (GPO) to configure the OS and Microsoft Edge in kiosk mode as well.</p>
<p>The autologon registry keys are basically the same; for the kiosk GPO that uses a local user, simply remove the <em>DefaultDomainName</em> registry key.</p>
<p><img src="https://4sysops.com/wp-content/uploads/2018/11/Autologon-registry-keys-600x95.png" alt="Autologon registry keys"></p>
<h2 id="5-a-namedeploymentwithaconfigurationmanagertasksequenceadeployment-with-a-configuration-manager-task-sequence">5. <a name='DeploymentwithaConfigurationManagertasksequence'></a>Deployment with a Configuration Manager task sequence</h2>
<p>How do we deploy the kiosk machines then? Well, in my lab, I use my own PowerShell front-end, which is not worth mentioning here. You can use collection variables, computer variables, or a front-end where you can select which kiosk you want to deploy. In the <em>Task Sequence</em>, I filter the group based on a <em>Task Sequence Variable</em>. I follow these steps:</p>
<ol>
<li>Run the PowerShell script to configure kiosk/assigned access</li>
<li>Move the computer to the correct OU</li>
<li>Restart the computer</li>
<li>Set the <em>SMSTSPostAction</em> to run &quot;cmd /c shutdown /r /t 60 /f&quot; that so far has applied the correct GPO so that autologon works after the first reboot. You could modify this to run a GPUpdate as well if necessary.</li>
</ol>
<p><img src="https://4sysops.com/wp-content/uploads/2018/11/Condition-for-the-KioskDomain-group.png" alt="Condition for the KioskDomain group"></p>
<p>Configuring the kiosk mode step that runs the script</p>
<p>For the step that moves the computer to the correct OU, I use the script I blogged about <a href="https://ccmexec.com/2018/03/move-the-computer-to-the-correct-ou-during-osd-ps-version/">here</a>. <a href="https://ccmexec.com/2016/10/web-service-for-os-deployment-sccm-configuration-manager-current-branch/">We could also use</a> a web service as long as we move the computer to the correct OU.</p>
<p><img src="https://4sysops.com/wp-content/uploads/2018/11/Moving-the-computer-object-to-the-OU-600x467.png" alt="Moving the computer object to the OU"></p>
<p>And the next step configures the <em>SMSTSpostaction</em>.</p>
<h2 id="6-a-namesubscribeto4sysopsnewsletterasubscribe-to-4sysops-newsletter">6. <a name='Subscribeto4sysopsnewsletter'></a>Subscribe to 4sysops newsletter!</h2>
<p><img src="https://4sysops.com/wp-content/uploads/2018/11/Setting-the-SMSTSpostaction-variable.png" alt="Setting the SMSTSpostaction variable"></p>
<p>That's it! We now have a script for configuring a Windows 10 1809 system in kiosk mode using either a local user account or a domain user account. The latter one is a bit more challenging to configure.</p>

    </div>
  </div>
</body>
</html>
