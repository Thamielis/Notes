<!DOCTYPE html>
<html>
<head>
<title>PowerShell Objekt erweitern - 2 einfache Möglichkeiten.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/*!
  Theme: GitHub Dark
  Description: Dark theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15

  Outdated base version: https://github.com/primer/github-syntax-dark
  Current colors taken from GitHub's CSS
*/

.hljs {
  color: #c9d1d9;
  background: #0d1117;
}

.hljs-doctag,
.hljs-keyword,
.hljs-meta .hljs-keyword,
.hljs-template-tag,
.hljs-template-variable,
.hljs-type,
.hljs-variable.language_ {
  /* prettylights-syntax-keyword */
  color: #ff7b72;
}

.hljs-title,
.hljs-title.class_,
.hljs-title.class_.inherited__,
.hljs-title.function_ {
  /* prettylights-syntax-entity */
  color: #d2a8ff;
}

.hljs-attr,
.hljs-attribute,
.hljs-literal,
.hljs-meta,
.hljs-number,
.hljs-operator,
.hljs-variable,
.hljs-selector-attr,
.hljs-selector-class,
.hljs-selector-id {
  /* prettylights-syntax-constant */
  color: #79c0ff;
}

.hljs-regexp,
.hljs-string,
.hljs-meta .hljs-string {
  /* prettylights-syntax-string */
  color: #a5d6ff;
}

.hljs-built_in,
.hljs-symbol {
  /* prettylights-syntax-variable */
  color: #ffa657;
}

.hljs-comment,
.hljs-code,
.hljs-formula {
  /* prettylights-syntax-comment */
  color: #8b949e;
}

.hljs-name,
.hljs-quote,
.hljs-selector-tag,
.hljs-selector-pseudo {
  /* prettylights-syntax-entity-tag */
  color: #7ee787;
}

.hljs-subst {
  /* prettylights-syntax-storage-modifier-import */
  color: #c9d1d9;
}

.hljs-section {
  /* prettylights-syntax-markup-heading */
  color: #1f6feb;
  font-weight: bold;
}

.hljs-bullet {
  /* prettylights-syntax-markup-list */
  color: #f2cc60;
}

.hljs-emphasis {
  /* prettylights-syntax-markup-italic */
  color: #c9d1d9;
  font-style: italic;
}

.hljs-strong {
  /* prettylights-syntax-markup-bold */
  color: #c9d1d9;
  font-weight: bold;
}

.hljs-addition {
  /* prettylights-syntax-markup-inserted */
  color: #aff5b4;
  background-color: #033a16;
}

.hljs-deletion {
  /* prettylights-syntax-markup-deleted */
  color: #ffdcd7;
  background-color: #67060c;
}

.hljs-char.escape_,
.hljs-link,
.hljs-params,
.hljs-property,
.hljs-punctuation,
.hljs-tag {
  /* purposely ignored */
}

</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>
<link rel="stylesheet" href="file://term08/c%24/ProgramData/UniversalAutomation/Repository/KnowledgeBase/styles/github-markdown.css" type="text/css"><link rel="stylesheet" href="file://term08/c%24/ProgramData/UniversalAutomation/Repository/KnowledgeBase/styles/markdown.css" type="text/css">
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body class="vscode-body vscode-dark">
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
  <div class="github-markdown-body github-markdown-auto">
    <div class="github-markdown-content">
      <h1 id="powershell-objekt-erweitern---2-einfache-m%C3%B6glichkeiten">PowerShell Objekt erweitern - 2 einfache Möglichkeiten</h1>
<!-- vscode-markdown-toc -->
<ul>
<li>
<ol>
<li><a href="#berblick">Überblick</a></li>
</ol>
</li>
<li>
<ol start="2">
<li><a href="#ObjektMemberanalysieren">Objekt Member analysieren</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#VierMglichkeiteneigeneObjektezuerschaffen">Vier Möglichkeiten eigene Objekte zu erschaffen</a></li>
</ol>
<ul>
<li>3.1. <a href="#PSCustomObjectperHashTableerzeugen">PSCustomObject per HashTable erzeugen</a></li>
<li>3.2. <a href="#PSCustomObjectperAdd-Membererzeugen">PSCustomObject per Add-Member erzeugen</a></li>
<li>3.3. <a href="#EigeneTypen-DefinitionperPowerShell">Eigene Typen-Definition per PowerShell</a></li>
<li>3.4. <a href="#EigeneTypen-DefinitionperC">Eigene Typen-Definition per C#</a></li>
</ul>
</li>
<li>
<ol start="4">
<li><a href="#Epilog">Epilog</a></li>
</ol>
</li>
</ul>
<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->
<h2 id="1-a-nameberblicka%C3%BCberblick">1. <a name='berblick'></a>Überblick</h2>
<p>Die <a href="https://de.wikipedia.org/wiki/Objektorientierte_Programmierung">objektorientierte Programmierung</a> (OOP) ist ein, nicht wegzudenkender Bestandteil der PowerShell. Wenn wir mit Objekten in der Shell arbeiten, nutzen wir deren Eigenschaften und Methoden, um Werte auszulesen oder Aktionen auszulösen. Dieser Informations- und Actionsumfang (Member =&gt; Eigenschaften, Methoden und Ereignisse) ist auf den jeweiligen Objekt-Typ beschränkt.</p>
<p>Diese Objekt-Erweiterung ist immer dann sinnvoll, <strong>wenn wir zusätzliche Daten über die Pipe transportieren wollen</strong> oder dauerhaft in der Sitzung eigene Aktionen in Objekten anstoßen möchten.</p>
<p>Neben vorhanden Objekte können neue Objekte über den Typ <code>[PSCustomObject]</code> erzeugt werden. Dieses leere Objekt kann, um einen Satz von eigenen Eigenschaften und Ereignisse ergänzt werden.</p>
<p>Mit <code>Add-Member</code> können Sie ein konkretes Objekt, um neue Eigenschaften und Methoden ergänzen. Mit <code>Update-TypeData</code> können Sie einen Typen in der aktuellen Session ergänzen, so dass alle Objekte von diesem Typ von der Erweiterung profitieren können. Das sind 2 einfache Möglichkeiten der Objekt-Erweiterung, um Individualität im Pipeline-Fluss zu bekommen.</p>
<p><img src="images/PowerShell-Objekt-Erweitern-Beispiel-1.png" alt=""></p>
<blockquote>
<p>TIPP - Zwei weitere spannende Artikel die gut zu diesem Thema passen sind: &quot;<a href="https://attilakrick.com/powershell/powershell-tutorial/">PowerShell Einstieg für Anfänger und Profis</a>&quot; &quot;<a href="https://attilakrick.com/powershell/powershell-objekt-analyse/">PowerShell Objekte in 3 Schritten erfolgreich analysieren</a>&quot;, und &quot;<a href="https://attilakrick.com/powershell/funktionsweise-powershell-pipeline/">PowerShell Pipeline Sinn &amp; Nutzen erklärt</a>&quot;.</p>
</blockquote>
<h2 id="2-a-nameobjektmemberanalysierenaobjekt-member-analysieren">2. <a name='ObjektMemberanalysieren'></a>Objekt Member analysieren</h2>
<p>Zuerst versschafen wir uns einen Überblick (IST-Aufnahme), <strong>welche Eigenschaften, Methoden und Ereignisse ein Object besitzt</strong>. U.a. erfahren wir auch so, wie das Objekt bereits für die PowerShell erweitert wurde.</p>
<p><img src="images/PowerShell-MemberTypes.png" alt=""></p>
<p>Die folgende Code-Zeile ...</p>
<pre class="hljs"><code><div><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Get-Member</span> <span class="hljs-literal">-View</span> <span class="hljs-string">'Adapted'</span>
</div></code></pre>
<p>... zeigt eine Liste von Eigenschaften, Methoden und Ereignisse die native (<code>Adapted</code>) im .NET-Typen <code>[System.Diagnostics.Process]</code> implementiert wurden. Das heißt dass diese Member in jeder .NET Programmiersprache aber auch in der PowerShell zur Verfügung steht und seitens <a href="https://docs.microsoft.com/de-de/dotnet/api/system.diagnostics.process">Microsoft supported und dokumentiert</a> wird.</p>
<p>Neben diesen nativen .NET-Eigenschaften, -Methoden und -Ereignisse lassen wir uns nun die Member anzeigen die <strong>bereits per PowerShell Erweiterungen hinzugefügt <code>Extended</code> wurden</strong>.</p>
<pre class="hljs"><code><div><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Get-Member</span> <span class="hljs-literal">-View</span> <span class="hljs-string">'Extended'</span>
</div></code></pre>
<p>Diese Member können nur in der PowerShell gesehen und verwendet werden.</p>
<p>Hier nun eine Zusammenfassung gruppiert nach Eigenschaften, Methoden und Ereignisse-Typ:</p>
<pre class="hljs"><code><div><span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Get-Member</span> <span class="hljs-literal">-View</span> <span class="hljs-string">'All'</span> | <span class="hljs-built_in">Group-Object</span> <span class="hljs-literal">-Property</span> <span class="hljs-string">'MemberType'</span> <span class="hljs-literal">-NoElement</span> | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Property</span> <span class="hljs-string">'Count'</span> <span class="hljs-literal">-Descending</span>
</div></code></pre>
<blockquote>
<p>TIPP - Wenn Sie mehrt über Objekt-Analyse verstehen wollen, dann lesen Sie: <a href="https://attilakrick.com/powershell/powershell-objekt-analyse/">PowerShell Objekte in 3 Schritten erfolgreich analysieren</a>.</p>
</blockquote>
<p><strong>Wenn nun die benötigte Eigenschaft oder Methode nicht vorhanden ist?</strong> Kein Problem! Das Typen-System der PowerShell ist flexibel. Wir ergänzen das aktuelle Objekt mit <code>Add-Member</code>. Dieses Verfahren hat den Vorteil, dass wir nicht komplett neue Typen definieren müssen und so redundanten Code implementieren würden.</p>
<p>Vorhandene Objekte oder eigene Objekte, um weitere Member zu erweitern ist immer dann sinnvoll, wenn a) weitere Daten oder Aktionen &quot;huckepack&quot; tranportiert werden sollen oder b) Objekte aus unterschiedlichen anderen Objekten und Informationen zusammengeführt werden sollen.</p>
<p>Ein Objekt kann auf unterschiedlichste Weise erweitert werden. Zum Beispiel soll in einem Anwendungsfall das Ergebnis unmittelbar nach der Berechnung einmalig in eine neue <code>NoteProperty</code>-Eigenschaft gespeichert werden. In einem anderen Fall erfolgt diese Berechnung jedes Mal beim Lesen der zuvor neu geschaffenen <code>ScriptProperty</code>-Eigenschaft. Folgende Objekt Erweiterungen stehen zur Verfügung:</p>
<table>
<thead>
<tr>
<th>Art</th>
<th>Beschreibung</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AliasProperty</code></td>
<td>Alias-Eigenschaft für eine andere vorhandene Property.</td>
</tr>
<tr>
<td><code>NoteProperty</code></td>
<td>Eine einfache Read/Write Property.</td>
</tr>
<tr>
<td><code>ScriptProperty</code></td>
<td>ScriptBlock-Code der jedesmal beim Lesen der Eigenschaft ausgeführt wird.</td>
</tr>
<tr>
<td><code>PropertySet</code></td>
<td>Eine Gruppe von Properties die über den Set-Namen angesprochen wird.</td>
</tr>
<tr>
<td><code>ScriptMethode</code></td>
<td>ScriptBlock-Code der beim Aufruf ausgeführt wird inkl. Argumenten-Übergabe</td>
</tr>
</tbody>
</table>
<p>Um Objekte erweitern zu können verwende ich für den weiteren Verlauf ein Windows Dienst-Objekt <code>$spooler</code>:</p>
<pre class="hljs"><code><div><span class="hljs-variable">$spooler</span> = <span class="hljs-built_in">Get-Service</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'Spooler'</span>
</div></code></pre>
<p>Das <code>$p1</code>-Objekt wird nun um einen <code>NoteProperty</code>-, <code>ScriptProperty</code>- und <code>ScriptMethod</code>-Member erweitert:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># ? Dem Dienst-Objekt eine NoteProperty hinzufügen</span>
<span class="hljs-variable">$spooler</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'HelpdeskAufgabe'</span> <span class="hljs-literal">-Value</span> <span class="hljs-string">'Der Spooler muss immer laufen und bei Problem Dienst neu starten.'</span> <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'NoteProperty'</span>

<span class="hljs-comment"># ? Dem Dienst-Objekt eine ScriptProperty hinzufügen</span>
<span class="hljs-variable">$spooler</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'ProzessId'</span> <span class="hljs-literal">-Value</span> { <span class="hljs-built_in">Get-CimInstance</span> <span class="hljs-literal">-ClassName</span> <span class="hljs-string">'Win32_Service'</span> <span class="hljs-literal">-Filter</span> <span class="hljs-string">"Name LIKE '<span class="hljs-variable">$</span>(<span class="hljs-keyword">$this</span>.ServiceName)'"</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> <span class="hljs-string">'ProcessId'</span> } <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'ScriptProperty'</span>
<span class="hljs-variable">$spooler</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'Laufzeit'</span> <span class="hljs-literal">-Value</span> { <span class="hljs-built_in">Get-Process</span> <span class="hljs-literal">-Id</span> <span class="hljs-keyword">$this</span>.ProzessId | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> <span class="hljs-string">'StartTime'</span> | <span class="hljs-built_in">New-TimeSpan</span> } <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'ScriptProperty'</span>

<span class="hljs-comment"># ? Dem Dienst-Objekt eine ScriptMethod hinzufügen</span>
<span class="hljs-variable">$spooler</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'Restart'</span> <span class="hljs-literal">-Value</span> { <span class="hljs-keyword">$this</span>.Stop() ; <span class="hljs-keyword">$this</span>.Start() } <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'ScriptMethod'</span>
</div></code></pre>
<p>Jetzt können wir die neuen Objekt-Erweiterung verwenden:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># ? Die neuen Properties und Methods anzeigen</span>
<span class="hljs-variable">$spooler</span> | <span class="hljs-built_in">Get-Member</span> <span class="hljs-literal">-View</span> <span class="hljs-string">'Extended'</span>

<span class="hljs-comment"># * Beispiel testen:</span>
<span class="hljs-variable">$spooler</span>.HelpdeskAufgabe <span class="hljs-comment"># ? NoteProperty   aufrufen =&gt; statisches Datum</span>
<span class="hljs-variable">$spooler</span>.ProzessId       <span class="hljs-comment"># ? ScriptProperty aufrufen =&gt; dynamisches Datum</span>
<span class="hljs-variable">$spooler</span>.Laufzeit        <span class="hljs-comment"># ? ScriptProperty aufrufen =&gt; dynamisches Datum</span>
<span class="hljs-variable">$spooler</span>.Restart()       <span class="hljs-comment"># ? ScriptMethod   aufrufen =&gt; dynamisches Datum</span>
</div></code></pre>
<p>Hier ein anderes Beispiel einer ScriptMethod-Erweiterung. Die neue Methode <code>SyncCreationLastTime</code> nimmt ein <code>datetime</code>-Objekt als Argument entgegen:</p>
<pre class="hljs"><code><div><span class="hljs-variable">$datei</span> = <span class="hljs-built_in">New-Item</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">'C:\temp\Test.txt'</span> <span class="hljs-literal">-Force</span>
<span class="hljs-variable">$datei</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'SyncCreationLastTime'</span> <span class="hljs-literal">-Value</span> {
        <span class="hljs-keyword">param</span>(
            [<span class="hljs-built_in">datetime</span>]<span class="hljs-variable">$newDateTime</span>
        )
        <span class="hljs-keyword">$this</span>.CreationTime   = <span class="hljs-variable">$newDateTime</span>
        <span class="hljs-keyword">$this</span>.LastWriteTime  = <span class="hljs-variable">$newDateTime</span>
        <span class="hljs-keyword">$this</span>.LastAccessTime = <span class="hljs-variable">$newDateTime</span>
    } <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'ScriptMethod'</span>
<span class="hljs-variable">$datei</span>.SyncCreationLastTime(<span class="hljs-string">'2020-12-31'</span>)
<span class="hljs-variable">$datei</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Property</span> Name, CreationTime, LastWriteTime, LastAccessTime
</div></code></pre>
<p><strong>Wie können sämtliche Objekte eines Typs erweitert werden?.</strong> Bis hierhin erweiterte <code>Add-Member</code> nur die Objekte direkt in der Pipeline oder eine Variable. Sollte jedoch Pipeline-Übergreifend sämtliche Objekte von einem Typ in der aktuellen Session erweitert werden, so müssen wir dies anders implementieren. In diesem Fall nehmen wir die Objekt Erweiterung direkt am Typ mittels <code>Update-TypeData</code> vor. Diese Art der Erweiterung wirkt sich nur in der Session auf alle Objekte vom gleichen Typ aus.</p>
<pre class="hljs"><code><div><span class="hljs-comment"># ? Session-weite Erweiterungen</span>
<span class="hljs-built_in">Update-TypeData</span> <span class="hljs-literal">-TypeName</span> <span class="hljs-string">'System.Diagnostics.Process'</span> <span class="hljs-literal">-MemberName</span> <span class="hljs-string">'WorkingSet64MB'</span> <span class="hljs-literal">-Value</span> { [<span class="hljs-built_in">int</span>](<span class="hljs-keyword">$this</span>.WorkingSet64 / <span class="hljs-number">1</span>MB) } <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'ScriptProperty'</span> <span class="hljs-literal">-Force</span>

<span class="hljs-comment"># ? Alle Process-Objects haben jetzt eine neue Property WorkingSet64MB</span>
<span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Get-Member</span> <span class="hljs-literal">-View</span> <span class="hljs-string">'Extended'</span>
<span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Property</span> <span class="hljs-string">'Name'</span>, <span class="hljs-string">'WorkingSet64MB'</span>
</div></code></pre>
<p>Im folgenden Beispiel sollen alle Objects der PowerShell eine Methode <code>OpenTypeNameSearch</code> bekommen. Wird diese Methode aufgerufen öffnet sich im Browser die Google-Suche die nach dem konkreten Typennamen sucht, um so mehr über diesen Typ in Erfahrung zu bringen.</p>
<pre class="hljs"><code><div><span class="hljs-built_in">Update-TypeData</span> <span class="hljs-literal">-TypeName</span> <span class="hljs-string">'System.Object'</span> <span class="hljs-literal">-MemberName</span> <span class="hljs-string">'OpenTypeNameSearch'</span> <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'ScriptMethod'</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-Value</span> {
    <span class="hljs-variable">$FullTypeName</span> = <span class="hljs-keyword">$this</span>.GetType().FullName
    <span class="hljs-variable">$SearchUrl</span> = <span class="hljs-string">"https://www.google.com/search?q=<span class="hljs-variable">$FullTypeName</span>"</span>
    <span class="hljs-built_in">Start-Process</span> <span class="hljs-literal">-FilePath</span> <span class="hljs-variable">$SearchUrl</span>
}

<span class="hljs-comment"># .OpenTypeNameSearch() testen</span>

<span class="hljs-variable">$p1</span> = <span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-First</span> <span class="hljs-number">1</span>
<span class="hljs-variable">$p1</span>.OpenTypeNameSearch() <span class="hljs-comment"># Google-Suche nach System.Diagnostics.Process startet</span>

<span class="hljs-variable">$s1</span> = <span class="hljs-built_in">Get-Service</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-First</span> <span class="hljs-number">1</span>
<span class="hljs-variable">$s1</span>.OpenTypeNameSearch() <span class="hljs-comment"># Google-Suche nach System.ServiceProcess.ServiceController</span>
</div></code></pre>
<p>In diesem Beispiel wird der Type <code>[System.Object]</code> bereichert. Sämtliche anderen Typen wurden früher oder später von Object abgeleitet was zu folge hat das die Methode <code>OpenTypeNameSearch</code> an allen Objekten, egal von welchem Typ vorhanden ist.</p>
<p><img src="images/PowerShell-Update-TypeData.png" alt=""></p>
<h2 id="3-a-nameviermglichkeiteneigeneobjektezuerschaffenavier-m%C3%B6glichkeiten-eigene-objekte-zu-erschaffen">3. <a name='VierMglichkeiteneigeneObjektezuerschaffen'></a>Vier Möglichkeiten eigene Objekte zu erschaffen</h2>
<p>Die oben beschriebenen Methoden kürzen vorhandene Objekte, um deren Member und fügen eigene Member hinzu so dass der ursprüngliche Sinn des Typen verloren geht. Im weiteren Verlauf der Objektverwertung können die Objekte nicht mehr auseinander gehalterden werden. In kurzen Pipeline-Verknüpfung-Ketten ist, das noch ein legitimes Mittel aber darüber hinauskommt, der Wunsch auf eigene Typen kreieren zu können. Hierzu stehen uns 4 Möglichkeiten zur Verfügung.</p>
<ul>
<li><code>PSCustomObject</code> per <code>HashTable</code> erzeugen</li>
<li><code>PSCustomObject</code> per <code>Add-Member</code> erzeugen</li>
<li>Eigene Typen-Definition per PowerShell</li>
<li>Eigene Typen-Definition per C#</li>
</ul>
<h3 id="31-a-namepscustomobjectperhashtableerzeugenapscustomobject-per-hashtable-erzeugen">3.1. <a name='PSCustomObjectperHashTableerzeugen'></a>PSCustomObject per HashTable erzeugen</h3>
<p>Ein effizienter Weg, um einfache Daten-Transport-Container schnell zu erschaffen ist das Konvertieren eines <code>HashTable</code>-Objekte in ein <code>PSCustomObject</code>-Objekt.</p>
<p><strong>Nachteile:</strong></p>
<ol>
<li>Unterschiedlich erzeugte <code>PSCustomObject</code>-Objekte können nicht auseinandergehalten werden.</li>
<li>Methoden und und Script-Eigenschaften können nicht implementiert werden.</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-comment"># PSCustomObject erzeugen</span>
<span class="hljs-variable">$PassivesObjekt</span> = [<span class="hljs-type">PSCustomObject</span>]<span class="hljs-selector-tag">@</span>{
    Ermittler      = <span class="hljs-string">'Attila Krick'</span>
    ComputerName   = <span class="hljs-variable">$env:COMPUTERNAME</span>
    ErstelltAm     = ( <span class="hljs-built_in">Get-Date</span> )
    BelegterRam    = [<span class="hljs-built_in">int</span>]((<span class="hljs-built_in">Get-Process</span> | <span class="hljs-built_in">Measure-Object</span> <span class="hljs-literal">-Property</span> WorkingSet64 <span class="hljs-literal">-Sum</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-ExpandProperty</span> Sum) / <span class="hljs-number">1</span>GB)
    AktiveProzesse = <span class="hljs-built_in">Get-Process</span>
}

<span class="hljs-comment"># PSCustomObject nutzen</span>
<span class="hljs-variable">$PassivesObjekt</span> | <span class="hljs-built_in">Get-Member</span>
<span class="hljs-variable">$PassivesObjekt</span>.Ermittler
<span class="hljs-variable">$PassivesObjekt</span>.ComputerName
<span class="hljs-variable">$PassivesObjekt</span>.ErstelltAm
<span class="hljs-variable">$PassivesObjekt</span>.BelegterRam
<span class="hljs-variable">$PassivesObjekt</span>.AktiveProzesse
</div></code></pre>
<h3 id="32-a-namepscustomobjectperadd-membererzeugenapscustomobject-per-add-member-erzeugen">3.2. <a name='PSCustomObjectperAdd-Membererzeugen'></a>PSCustomObject per Add-Member erzeugen</h3>
<p>Die resultierenden Objekte sind identisch wie bei 1.. Zusätzlich können wir die <code>PSCustomObject</code>-Objekte mittels <code>Add-Member</code>, um dynamischen Member wie <code>ScriptProperty</code> und <code>ScriptMethod</code> bereichern.</p>
<p><strong>Nachteile:</strong></p>
<ol>
<li>Siehe Nachteile A.</li>
<li>Erhöhter Erstellungsaufwand.</li>
<li>Lesbarkeit könnte leide da Komplexer und Abstrakter.</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-comment"># PSCustomObject erzeugen</span>
<span class="hljs-variable">$AktivesObjekt</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> <span class="hljs-string">'PSCustomObject'</span>
<span class="hljs-variable">$AktivesObjekt</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'ErstelltAm'</span> <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'NoteProperty'</span> <span class="hljs-literal">-Value</span> ( <span class="hljs-built_in">Get-Date</span> )
<span class="hljs-variable">$AktivesObjekt</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'JetztIst'</span> <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'ScriptProperty'</span> <span class="hljs-literal">-Value</span> { <span class="hljs-built_in">Get-Date</span> }
<span class="hljs-variable">$AktivesObjekt</span> | <span class="hljs-built_in">Add-Member</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">'PasswortGenerieren'</span> <span class="hljs-literal">-MemberType</span> <span class="hljs-string">'ScriptMethod'</span> <span class="hljs-literal">-Value</span> {
    <span class="hljs-keyword">param</span>([<span class="hljs-built_in">Byte</span>]<span class="hljs-variable">$AnzahlZeichen</span> = <span class="hljs-number">10</span>)
    <span class="hljs-keyword">return</span> [<span class="hljs-type">Convert</span>]::ToBase64String((<span class="hljs-number">0</span>..<span class="hljs-number">255</span> | <span class="hljs-built_in">Get-Random</span> <span class="hljs-literal">-Count</span> <span class="hljs-number">255</span>)).SubString(<span class="hljs-number">0</span>, <span class="hljs-variable">$AnzahlZeichen</span>)
}

<span class="hljs-comment"># PSCustomObject nutzen</span>
<span class="hljs-variable">$AktivesObjekt</span> | <span class="hljs-built_in">Get-Member</span>
<span class="hljs-variable">$AktivesObjekt</span>.ErstelltAm
<span class="hljs-variable">$AktivesObjekt</span>.JetztIst
<span class="hljs-variable">$AktivesObjekt</span>.PasswortGenerieren(<span class="hljs-number">12</span>)
</div></code></pre>
<h3 id="33-a-nameeigenetypen-definitionperpowershellaeigene-typen-definition-per-powershell">3.3. <a name='EigeneTypen-DefinitionperPowerShell'></a>Eigene Typen-Definition per PowerShell</h3>
<p>Per Definition können einfache Klassen erzeugt werden die Eigenschaften und Methoden besitzen. Anschließend können Objekte erzeugt werden, die sich klar von anderen Objekten und deren Typen abgrenzen. Weiterhin ist nur ein geringes Grundverständnis der objektorientierten Programmierung (OOP) nötig. Alles was Sie dazu benötigen finden Sie unter: <code>Get-Help -Name 'about_Classes' -ShowWindow</code>.</p>
<p><strong>Nachteil:</strong></p>
<ol>
<li>Es stehen nicht alle Möglichkeiten der OOP für diese Art der Implementierung zur Verfügung.</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-comment"># Eigene Klasse XAkte definieren</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">XAkte</span></span> {

    <span class="hljs-comment"># Private Variable</span>
    <span class="hljs-comment"># Nur innerhalb des Objektes, kann auf sie zugegriffen werden.</span>
    <span class="hljs-keyword">hidden</span> [<span class="hljs-built_in">string</span>]<span class="hljs-variable">$_Titel</span>

    <span class="hljs-comment"># Eine Read/Write-Property vom Typ Byte</span>
    <span class="hljs-comment"># mit einem gültigen Wertbereich von 10 bis 100 und dem Default-Wert 10.</span>
    [<span class="hljs-type">ValidateRange</span>(<span class="hljs-number">10</span>, <span class="hljs-number">1000</span>)]
    [<span class="hljs-built_in">Byte</span>]<span class="hljs-variable">$AufwandStunden</span> = <span class="hljs-number">10</span>

    <span class="hljs-comment"># Konstruktor</span>
    <span class="hljs-comment"># Code der einmalig beim Erzeugen eines neuen Objektes ausgeführt wird.</span>
    XAkte([<span class="hljs-built_in">string</span>]<span class="hljs-variable">$titel</span>) {
        <span class="hljs-keyword">$this</span>._Titel = <span class="hljs-variable">$titel</span>
    }

    <span class="hljs-comment"># Eine Methode mit Rückgabe</span>
    <span class="hljs-comment"># und ohne Argumenten Übergabe.</span>
    <span class="hljs-function">[<span class="hljs-built_in">string</span>]<span class="hljs-title">GetTitel</span></span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>._Titel
    }

    <span class="hljs-comment"># Eine Methode mit Argumenten Übergabe</span>
    <span class="hljs-comment"># und ohne Rückgabe.</span>
    [<span class="hljs-built_in">void</span>]AkteSchließen([<span class="hljs-built_in">string</span>]<span class="hljs-variable">$autorisierungcode</span>) {
        <span class="hljs-string">"Die XAkte <span class="hljs-variable">$</span>(<span class="hljs-keyword">$this</span>._Titel) wurde am <span class="hljs-variable">$</span>(Get-Date -Format 'dd.MM.yyyy') nach <span class="hljs-variable">$</span>(<span class="hljs-keyword">$this</span>.AufwandStunden) Stunden geschlossen. Autorisierungcode: <span class="hljs-variable">$autorisierungcode</span>"</span> | <span class="hljs-built_in">Add-Content</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">'C:\Temp\XAkten.log'</span>
    }
}

<span class="hljs-comment"># XAkte-Objekt(e) nutzen</span>
<span class="hljs-variable">$x</span> = [<span class="hljs-type">XAkte</span>]::new(<span class="hljs-string">'TH34X'</span>)
<span class="hljs-variable">$x</span>.AufwandStunden = <span class="hljs-number">99</span>
<span class="hljs-string">'Titel der $x XAkte ist {0}'</span> <span class="hljs-operator">-f</span> <span class="hljs-variable">$x</span>.GetTitel() | <span class="hljs-built_in">Write-Warning</span>
<span class="hljs-variable">$x</span>.AkteSchließen(<span class="hljs-string">'08-15-47-11'</span>)
<span class="hljs-built_in">Get-Content</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">'C:\Temp\XAkten.log'</span>
</div></code></pre>
<h3 id="34-a-nameeigenetypen-definitionpercaeigene-typen-definition-per-c">3.4. <a name='EigeneTypen-DefinitionperC'></a>Eigene Typen-Definition per C#</h3>
<p>Per C#-Definition können komplexe Klassen erzeugt werden die Eigenschaften, Methoden, Ereignisse etc. besitzen. Anschließend können Objekte erzeugt werden, die sich klar von anderen Objekten und deren Typen abgrenzen. Es stehen <strong>ALLE Möglichkeiten der OOP</strong> für diese Art der Implementierung zur Verfügung.</p>
<p><strong>Nachteile:</strong></p>
<ol>
<li>Es ein ausführliches Wissen der objektorientierten Programmierung (OOP) nötig.</li>
<li>Die Entwicklung solch einer komplexen Klasse benötigt eine C# Entwicklungsumgebung.</li>
</ol>
<pre class="hljs"><code><div><span class="hljs-built_in">Add-Type</span> <span class="hljs-literal">-Language</span> <span class="hljs-string">'CSharp'</span> <span class="hljs-literal">-TypeDefinition</span> <span class="hljs-string">@'
using System;

public class YAkte
{
    // Private Variable (Feld)
    // Nur innerhalb des Objektes, kann auf sie zugegriffen werden.
    private byte _AufwandStunden = 10;

    // Eine Read/Write-Property vom Typ Byte
    // mit einem gültigen Wertbereich von 10 bis 100 und dem Default-Wert 10
    // sowie das nur Stunden hinzugebucht aber nicht abgezogen werden können.
    public byte AufwandStunden
    {
        get { return _AufwandStunden; }
        set
        {
            if (value &lt; _AufwandStunden)
                throw new ArgumentOutOfRangeException("value", "Der Stunden-Aufwand kann nachträglich nicht vermindert werden.");
            if (value &lt; 10 || value &gt; 100)
                throw new ArgumentOutOfRangeException("value", "Der Stunden-Aufwand muss &gt;= 10 und &lt;= 100 Stunden sein.");
            _AufwandStunden = value;
        }
    }

    // Eine ReadOnly-Property vom Typ String
    public string Titel { get; private set; }

    // Konstruktor
    // Code der einmalig beim Erzeugen eins neuen Objekts ausgeführt wird.
    public YAkte(string titel)
    {
        Titel = titel;
    }
}
'@</span>

<span class="hljs-comment"># YAkte-Objekt(e) nutzen</span>
<span class="hljs-variable">$y</span> = [<span class="hljs-type">YAkte</span>]::new(<span class="hljs-string">'DF88G'</span>)
<span class="hljs-variable">$y</span>.AufwandStunden = <span class="hljs-number">11</span>
<span class="hljs-variable">$y</span>.AufwandStunden = <span class="hljs-number">10</span> <span class="hljs-comment"># ! Nicht möglich</span>
<span class="hljs-string">'Titel der $y YAkte ist {0}'</span> <span class="hljs-operator">-f</span> <span class="hljs-variable">$y</span>.Titel | <span class="hljs-built_in">Write-Warning</span>
<span class="hljs-variable">$y</span>.Titel = <span class="hljs-string">'Neuer Titel'</span> <span class="hljs-comment"># ! Nicht möglich</span>
</div></code></pre>
<h2 id="4-a-nameepilogaepilog">4. <a name='Epilog'></a>Epilog</h2>
<p>Wollen Sie dauerhaft von diesen Typen-Erweiterungen profitieren so könnten Sie diesen Code in einer der <code>profile.ps1</code> Dateien speichern:</p>
<pre class="hljs"><code><div><span class="hljs-variable">$profile</span>.AllUsersAllHosts
<span class="hljs-variable">$profile</span>.AllUsersCurrentHost
<span class="hljs-variable">$profile</span>.CurrentUserAllHosts
<span class="hljs-variable">$profile</span>.CurrentUserCurrentHost
</div></code></pre>
<p>Oder Sie implementieren den Code in ein eigenes Modul (<code>.PSM1</code>).</p>

    </div>
  </div>
</body>
</html>
