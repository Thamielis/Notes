![](PowerShell%20Tip%20of%20the%20Week%20Check%20connectivity%20to%20multiple%20servers%20-%20Powershellbros.com/results.png)

You can find multiple articles on our blog about checking connectivity. This time I want to show you how to check it for bunch of servers on specific port.

##### Check connectivity

Script will use `Test-NetConnection` command where you can specify port number. For single machine you can use the following one-liner script:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p></td><td><div><p><code>$Server</code> <code>= </code><code>"DC01"</code></p><p><code>$DServer</code> <code>= </code><code>"SCOM01"</code></p><p><code>$Port</code> <code>= </code><code>"5723"</code></p><p><code>Invoke-Command</code>&nbsp; <code>-ComputerName</code> <code>$Server</code> <code>-ScriptBlock</code><code>{</code><code>param</code><code>(</code><code>$Port</code><code>,</code><code>$DServer</code><code>) </code><code>Test-netconnection</code> <code>-Port</code> <code>$Port</code> <code>-cn</code> <code>$DServer</code> <code>-InformationLevel</code> <code>Quiet }</code> <code>-ArgumentList</code> <code>$Port</code><code>,</code><code>$DServer</code></p></div></td></tr></tbody></table>

On the beginning you have to provide servers and destination servers againts which you want to check connection:

<table><tbody><tr><td><p>1</p><p>2</p></td><td><div><p><code>$Servers</code> <code>= </code><code>Get-Content</code> <code>-Path</code> <code>"d:\scripts\servers.txt"</code></p><p><code>$DestinationServ</code> <code>= </code><code>"SCOM01"</code><code>,</code><code>"SCOM02"</code><code>,</code><code>"SCOM03"</code><code>,</code><code>"SCOMO4"</code><code>,</code><code>"SCOM05"</code><code>,</code><code>"SCOM06"</code></p></div></td></tr></tbody></table>

At the end output should look like this:  

[![Check connectivity](PowerShell%20Tip%20of%20the%20Week%20Check%20connectivity%20to%20multiple%20servers%20-%20Powershellbros.com/Check-connectivity.png)](https://i0.wp.com/www.powershellbros.com/wp-content/uploads/2018/01/Check-connectivity.png)

Check connectivity

**Final script:**

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p></td><td><div><p><code>$Servers</code> <code>= </code><code>Get-Content</code> <code>-Path</code> <code>"d:\scripts\servers.txt"</code></p><p><code>$DestinationServ</code> <code>= </code><code>"SCOM01"</code><code>,</code><code>"SCOM02"</code><code>,</code><code>"SCOM03"</code><code>,</code><code>"SCOMO4"</code><code>,</code><code>"SCOM05"</code><code>,</code><code>"SCOM06"</code></p><p><code>$Array</code> <code>= @()</code></p><p><code>$Port</code> <code>= </code><code>"5723"</code></p><p><code>Foreach</code><code>(</code><code>$Server</code> <code>in</code> <code>$Servers</code><code>)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Obejct</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$FQDN</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Server</code> <code>= </code><code>$Server</code><code>.Trim()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host</code> <code>Processing </code><code>$Server</code> <code>-ForegroundColor</code> <code>Green</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$FQDN</code> <code>= (</code><code>[System.Net.Dns]</code><code>::GetHostByName((</code><code>"$Server"</code><code>)))</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(!</code><code>$FQDN</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host</code> <code>"$Server does not exist"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Else</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>= </code><code>New-Object</code> <code>PSCustomObject</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Server name"</code> <code>-Value</code> <code>$server</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Port"</code> <code>-Value</code> <code>$Port</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Foreach</code><code>(</code><code>$DServer</code> <code>in</code> <code>$DestinationServ</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Test</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Try</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Test</code> <code>= </code><code>Invoke-Command</code>&nbsp; <code>-ComputerName</code> <code>$Server</code> <code>-ErrorAction</code> <code>Stop</code> <code>-ScriptBlock</code><code>{</code><code>param</code><code>(</code><code>$Port</code><code>,</code><code>$DServer</code><code>) </code><code>Test-netconnection</code> <code>-Port</code> <code>$Port</code> <code>-cn</code> <code>$DServer</code> <code>-InformationLevel</code> <code>Quiet }</code> <code>-ArgumentList</code> <code>$Port</code><code>,</code><code>$DServer</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(</code><code>$Test</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"$DServer"</code> <code>-Value</code> <code>$Test</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Catch</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Warning</code> <code>$_</code><code>.Exception.Message</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"$DServer"</code> <code>-Value</code> <code>"null"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>+= </code><code>$Object</code>&nbsp;&nbsp;</p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p><p><code>Write-Host</code> <code>"Results:"</code> <code>-Foreground</code> <code>Yellow</code></p><p><code>$Array</code> <code>| </code><code>Format-Table</code> <code>-Wrap</code> <code>-AutoSize</code></p><p><code>$Array</code> <code>| </code><code>Export-Csv</code> <code>-Path</code> <code>d:\scripts\results.csv</code> <code>-NoTypeInformation</code></p></div></td></tr></tbody></table>