If you would like to quickly display CPU and Memory utilization in PowerShell console then this script is for you. This is another great example on how to use PowerShell custom objects and add it to array.

##### CPU and Memory utilization

In past I often had this situation when one of the servers was unresponsive due to high performance which was causing service interruption. Unfortunately SCOM server didn’t catch that CPU or Memory sudden spike and I had to scan all of our servers manually to find what is happening. This is why the following script has been created to avoid similar cases in the future and to quickly identify culprit.

Script is based on `Get-WmiObject` commands:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p></td><td><div><p><code>$Processor</code> <code>= (</code><code>Get-WmiObject</code> <code>-ComputerName</code> <code>$Server</code> <code>-Class</code> <code>win32_processor</code> <code>-ErrorAction</code> <code>Stop | </code><code>Measure-Object</code> <code>-Property</code> <code>LoadPercentage</code> <code>-Average</code> <code>| </code><code>Select-Object</code> <code>Average).Average</code></p><p><code>$ComputerMemory</code> <code>= </code><code>Get-WmiObject</code> <code>-ComputerName</code> <code>$Server</code> <code>-Class</code> <code>win32_operatingsystem</code> <code>-ErrorAction</code> <code>Stop</code></p><p><code>$Memory</code> <code>= (((</code><code>$ComputerMemory</code><code>.TotalVisibleMemorySize - </code><code>$ComputerMemory</code><code>.FreePhysicalMemory)*100)/ </code><code>$ComputerMemory</code><code>.TotalVisibleMemorySize)</code></p><p><code>$RoundMemory</code> <code>= </code><code>[math]</code><code>::Round(</code><code>$Memory</code><code>, 2)</code></p></div></td></tr></tbody></table>

**Output (Script 2):**

[![CPU and Memory](Run%20script%20to%20check%20CPU%20and%20Memory%20utilization%20via%20PowerShell%20script/CPU-and-Memory.png)](https://i0.wp.com/www.powershellbros.com/wp-content/uploads/2017/04/CPU-and-Memory.png)

CPU and Memory

**Script 1:**

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p></td><td><div><p><code>$Servers</code> <code>= </code><code>Get-Content</code> <code>"C:\users\$env:username\desktop\servers.txt"</code></p><p><code>$Array</code> <code>= @()</code></p><p><code>ForEach</code> <code>(</code><code>$Server</code> <code>in</code> <code>$Servers</code><code>) {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Check</code> <code>= </code><code>$Processor</code> <code>= </code><code>$ComputerMemory</code> <code>= </code><code>$RoundMemory</code> <code>= </code><code>$Object</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Server</code> <code>= </code><code>$Server</code><code>.trim()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Try {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Processor</code> <code>= (</code><code>Get-WmiObject</code> <code>-ComputerName</code> <code>$Server</code> <code>-Class</code> <code>win32_processor</code> <code>-ErrorAction</code> <code>Stop | </code><code>Measure-Object</code> <code>-Property</code> <code>LoadPercentage</code> <code>-Average</code> <code>| </code><code>Select-Object</code> <code>Average).Average</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$ComputerMemory</code> <code>= </code><code>Get-WmiObject</code> <code>-ComputerName</code> <code>$Server</code> <code>-Class</code> <code>win32_operatingsystem</code> <code>-ErrorAction</code> <code>Stop</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Memory</code> <code>= (((</code><code>$ComputerMemory</code><code>.TotalVisibleMemorySize - </code><code>$ComputerMemory</code><code>.FreePhysicalMemory)*100)/ </code><code>$ComputerMemory</code><code>.TotalVisibleMemorySize)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$RoundMemory</code> <code>= </code><code>[math]</code><code>::Round(</code><code>$Memory</code><code>, 2)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>= </code><code>New-Object</code> <code>PSCustomObject</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Server name"</code> <code>-Value</code> <code>$Server</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"CPU %"</code> <code>-Value</code> <code>$Processor</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Memory %"</code> <code>-Value</code> <code>$RoundMemory</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>+= </code><code>$Object</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Catch {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host</code> <code>"Something went wrong ($Server): "</code><code>$_</code><code>.Exception.Message</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Continue</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p><p><code>If</code> <code>(</code><code>$Array</code><code>) {</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>| </code><code>Out-GridView</code> <code>-Title</code> <code>"CPU and Memory"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>| </code><code>Export-Csv</code> <code>-Path</code> <code>"C:\users\$env:username\desktop\results.csv"</code> <code>-NoTypeInformation</code> <code>-Force</code></p><p><code>}</code></p></div></td></tr></tbody></table>

**Script 2:**

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p><p>64</p><p>65</p><p>66</p><p>67</p><p>68</p><p>69</p><p>70</p><p>71</p><p>72</p><p>73</p><p>74</p><p>75</p><p>76</p><p>77</p><p>78</p><p>79</p></td><td><div><p><code>$Servers</code> <code>= </code><code>Get-Content</code> <code>"C:\users\$env:username\desktop\servers.txt"</code></p><p><code>$Array</code> <code>= @()</code></p><p><code>ForEach</code><code>(</code><code>$Server</code> <code>in</code> <code>$Servers</code><code>)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Server</code> <code>= </code><code>$Server</code><code>.trim()</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host</code> <code>"Processing $Server"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Check</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Processor</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$ComputerMemory</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$RoundMemory</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>= </code><code>New-Object</code> <code>PSCustomObject</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Server name"</code> <code>-Value</code> <code>$Server</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Check</code> <code>= </code><code>Test-Path</code> <code>-Path</code> <code>"\\$Server\c$"</code> <code>-ErrorAction</code> <code>SilentlyContinue</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(</code><code>$Check</code> <code>-match</code> <code>"True"</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Status</code> <code>= </code><code>"True"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Try</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Processor</code> <code>= (</code><code>Get-WmiObject</code> <code>-ComputerName</code> <code>$Server</code> <code>-Class</code> <code>win32_processor</code> <code>-ErrorAction</code> <code>Stop | </code><code>Measure-Object</code> <code>-Property</code> <code>LoadPercentage</code> <code>-Average</code> <code>| </code><code>Select-Object</code> <code>Average).Average</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$ComputerMemory</code> <code>= </code><code>Get-WmiObject</code> <code>-ComputerName</code> <code>$Server</code> <code>-Class</code> <code>win32_operatingsystem</code> <code>-ErrorAction</code> <code>Stop</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Memory</code> <code>= (((</code><code>$ComputerMemory</code><code>.TotalVisibleMemorySize - </code><code>$ComputerMemory</code><code>.FreePhysicalMemory)*100)/ </code><code>$ComputerMemory</code><code>.TotalVisibleMemorySize)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$RoundMemory</code> <code>= </code><code>[math]</code><code>::Round(</code><code>$Memory</code><code>, 2)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Catch</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host</code> <code>"Something went wrong"</code> <code>-ForegroundColor</code> <code>Red</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Continue</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(!</code><code>$Processor</code> <code>-and</code> <code>$RoundMemory</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$RoundMemory</code> <code>= </code><code>"(null)"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Processor</code> <code>= </code><code>"(null)"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Is online?"</code> <code>-Value</code> <code>$Status</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Memory %"</code> <code>-Value</code> <code>$RoundMemory</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"CPU %"</code> <code>-Value</code> <code>$Processor</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>+= </code><code>$Object</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Else</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Is online?"</code> <code>-Value</code> <code>"False"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Memory %"</code> <code>-Value</code> <code>"(null)"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"CPU %"</code> <code>-Value</code> <code>"(null)"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>+= </code><code>$Object</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}&nbsp;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(</code><code>$Array</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>| </code><code>Sort-Object</code> <code>"Is online?"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p></div></td></tr></tbody></table>

Please check also article about getting memory utilization report – [link](http://www.powershellbros.com/get-memory-utilization-report-using-powershell/).