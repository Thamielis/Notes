I recently had to scan system event log on all production servers to find out which services have been installed. In this article I will describe how to scan your infrastracture for this specific event.

For selecting servers I used **Out-GridView** command:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p></td><td><div><p><code>$List</code> <code>= ( </code><code>Import-Csv</code> <code>'D:\scripts\Servers.csv'</code> <code>)</code></p><p><code>$Servers</code> <code>= </code><code>$List</code> <code>| </code><code>Out-GridView</code> <code>-Title</code>&nbsp; <code>"Select Servers (Holding CTRL Button)"</code> <code>-PassThru</code></p></div></td></tr></tbody></table>

Please note that in **Foreach** loop you need to provide name for servers column in CSV file – in my case it was **“Server name”**:

<table><tbody><tr><td><p>1</p></td><td><div><p><code>ForEach</code><code>(</code><code>$Server</code> <code>in</code> <code>$Servers</code><code>.</code><code>"Server name"</code><code>)</code></p></div></td></tr></tbody></table>

We have to find eventid **7045** where message start with “A service was installed in the system”. We also have to exclude events for **NT AUTHORITY\\SYSTEM**. To scan event log we can use command available in PowerShell **Get-EventLog**:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p></td><td><div><p><code>Get-EventLog</code> <code>-log</code> <code>"System"</code> <code>-Source</code> <code>"Service Control Manager"</code> <code>| </code><code>Where-Object</code> <code>{</code><code>$_</code><code>.EventId </code><code>-eq</code> <code>"7045"</code> <code>-and</code> <code>$_</code><code>.UserName </code><code>-notlike</code> <code>"NT AUTHORITY\SYSTEM"</code><code>}</code></p></div></td></tr></tbody></table>

[![eventlog](Scan%20event%20log%20to%20find%20if%20service%20was%20installed%20in%20the%20system%20-%20Powershellbros.com/eventlog.png)](https://i0.wp.com/www.powershellbros.com/wp-content/uploads/2017/07/eventlog.png)

eventlog

Script will create Array with following information:

– Server  
– EventID  
– Date  
– User  
– Service  
– Path

At the end results will be displayed in formatted table in host:

<table><tbody><tr><td><p>1</p></td><td><div><p><code>$Array</code> <code>| </code><code>Format-Table</code> <code>-AutoSize</code></p></div></td></tr></tbody></table>

If you need to open results in new window or save it in CSV file then you can use this examples:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p></td><td><div><p><code>$Array</code> <code>| </code><code>Sort-Object</code> <code>Service | </code><code>Out-GridView</code> <code>-Title</code> <code>"Services"</code></p><p><code>$Array</code> <code>| </code><code>Export-Csv</code> <code>-Path</code> <code>C:\users\</code><code>$env:username</code><code>\desktop\results.csv</code> <code>-NoTypeInformation</code></p></div></td></tr></tbody></table>

**Final script:**

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p></td><td><div><p><code>$ErrorActionPreference</code> <code>= </code><code>"Stop"</code></p><p><code>$Array</code> <code>= @()</code></p><p><code>$Time</code> <code>= </code><code>"5"</code></p><p><code>$List</code> <code>= ( </code><code>Import-Csv</code> <code>'D:\scripts\Servers.csv'</code> <code>)</code></p><p><code>$Servers</code> <code>= </code><code>$List</code> <code>| </code><code>Out-GridView</code> <code>-Title</code>&nbsp; <code>"Select Servers (Holding CTRL Button)"</code> <code>-PassThru</code></p><p><code>If</code><code>(!</code><code>$Servers</code><code>)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Warning</code> <code>"Servers have not been selected"</code></p><p><code>}</code></p><p><code>Else</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ForEach</code><code>(</code><code>$Server</code> <code>in</code> <code>$Servers</code><code>.</code><code>"Server name"</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Warning</code> <code>"Processing $server"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Try</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Events</code> <code>= </code><code>Invoke-Command</code> <code>-ComputerName</code> <code>$Server</code> <code>-ScriptBlock</code><code>{</code><code>param</code><code>(</code><code>$Time</code><code>) </code><code>Get-EventLog</code> <code>-log</code> <code>"System"</code> <code>-Source</code> <code>"Service Control Manager"</code> <code>-After</code> <code>(</code><code>Get-Date</code><code>).AddDays(-</code><code>$Time</code><code>) |</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Where-Object</code> <code>{</code><code>$_</code><code>.EventId </code><code>-eq</code> <code>"7045"</code> <code>-and</code> <code>$_</code><code>.UserName </code><code>-notlike</code> <code>"NT AUTHORITY\SYSTEM"</code><code>}}</code> <code>-ArgumentList</code> <code>$Time</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Catch</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$_</code><code>.Exception.Message</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Continue</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(</code><code>$Events</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ForEach</code><code>(</code><code>$Event</code> <code>in</code> <code>$Events</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>= </code><code>New-Object</code> <code>PSObject</code> <code>-Property</code> <code>(</code><code>[ordered]</code><code>@{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Server&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = </code><code>$Server</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>EventID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = </code><code>$Event</code><code>.EventId</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Date&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = </code><code>$Event</code><code>.TimeGenerated</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>User&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = </code><code>$Event</code><code>.Username</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Service&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = </code><code>$Event</code><code>.ReplacementStrings[0]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Path&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = </code><code>$Event</code><code>.ReplacementStrings[1]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>})</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>+= </code><code>$Object</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(</code><code>$Array</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Host</code> <code>"`nResults:"</code> <code>-ForegroundColor</code> <code>Yellow</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Array</code> <code>| </code><code>Format-Table</code> <code>-AutoSize</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p></div></td></tr></tbody></table>