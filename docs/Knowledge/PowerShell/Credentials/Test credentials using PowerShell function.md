Test credentials is definitely one of the most important prerequisites when it comes to more advanced scripts. When you looping multiple remote servers and you provide wrong password in your credentials variable then your account might be locked out. Below you will find simple way to avoid such situations.

##### Test credentials

The `Get-Credential` cmdlet prompts the user for a password or a user name and password. By default, an authentication dialog box appears to prompt the user. However, in some host programs, such as the Windows PowerShell console, you can prompt the user at the command line by changing a registry entry. For more information about this registry entry, see the notes and examples. For more info go to [Microsoft docs page](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/get-credential?view=powershell-5.1).

[![Get-Credential](Test%20credentials%20using%20PowerShell%20function%20-%20Powershellbros.com/Get-Credential.png)](https://i2.wp.com/www.powershellbros.com/wp-content/uploads/2018/01/Get-Credential.png)

Get-Credential

**Usage:**  
You can use this function in several ways. If you type `Test-Cred` it will ask you to provide credentials and return value **“Authenticated”** or **“Not authenticated”**:

[![Test-Cred](Test%20credentials%20using%20PowerShell%20function%20-%20Powershellbros.com/Test-Cred.png)](https://i0.wp.com/www.powershellbros.com/wp-content/uploads/2018/01/Test-Cred.png)

Test-Cred

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p></td><td><div><p><code>$Credentials</code> <code>= </code><code>Get-Credential</code> <code>domain\</code><code>$env:username</code></p><p><code>$Credentials</code> <code>| </code><code>Test-Cred</code></p></div></td></tr></tbody></table>

[![Test Credentials](Test%20credentials%20using%20PowerShell%20function%20-%20Powershellbros.com/Test-Credentials.png)](https://i0.wp.com/www.powershellbros.com/wp-content/uploads/2018/01/Test-Credentials.png)

Test Credentials

You can also load function on the beginning of the script and later use it as a one of the verification steps:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p></td><td><div><p><code>$CredCheck</code> <code>= </code><code>$Credentials</code>&nbsp; <code>| </code><code>Test-Cred</code></p><p><code>If</code><code>(</code><code>$CredCheck</code> <code>-ne</code> <code>"Authenticated"</code><code>)</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Warning</code> <code>"Credential validation failed"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>pause</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Break</code></p><p><code>}</code></p></div></td></tr></tbody></table>

Additionaly script will break if you will not provide any input:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p></td><td><div><p><code>Try</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Credentials</code> <code>= </code><code>Get-Credential</code> <code>"domain\$env:username"</code> <code>-ErrorAction</code> <code>Stop</code></p><p><code>}</code></p><p><code>Catch</code></p><p><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$ErrorMsg</code> <code>= </code><code>$_</code><code>.Exception.Message</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Warning</code> <code>"Failed to validate credentials: $ErrorMsg "</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Pause</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Break</code></p><p><code>}</code></p></div></td></tr></tbody></table>

[![Test-Cred error](Test%20credentials%20using%20PowerShell%20function%20-%20Powershellbros.com/Test-Cred-error.png)](https://i1.wp.com/www.powershellbros.com/wp-content/uploads/2018/01/Test-Cred-error.png)

Test-Cred error

**Final script:**

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p><p>28</p><p>29</p><p>30</p><p>31</p><p>32</p><p>33</p><p>34</p><p>35</p><p>36</p><p>37</p><p>38</p><p>39</p><p>40</p><p>41</p><p>42</p><p>43</p><p>44</p><p>45</p><p>46</p><p>47</p><p>48</p><p>49</p><p>50</p><p>51</p><p>52</p><p>53</p><p>54</p><p>55</p><p>56</p><p>57</p><p>58</p><p>59</p><p>60</p><p>61</p><p>62</p><p>63</p><p>64</p><p>65</p><p>66</p><p>67</p><p>68</p><p>69</p><p>70</p><p>71</p><p>72</p></td><td><div><p><code>function</code> <code>Test-Cred</code> <code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[</code><code>CmdletBinding</code><code>()]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[OutputType(</code><code>[String]</code><code>)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Param</code> <code>(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[</code><code>Parameter</code><code>(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Mandatory</code> <code>= </code><code>$false</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ValueFromPipeLine</code> <code>= </code><code>$true</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>ValueFromPipelineByPropertyName</code> <code>= </code><code>$true</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[</code><code>Alias</code><code>(</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>'PSCredential'</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>)]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[ValidateNotNull()]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[System.Management.Automation.PSCredential]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[System.Management.Automation.Credential()]</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Credentials</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Domain</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Root</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Username</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Password</code> <code>= </code><code>$null</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(</code><code>$Credentials</code> <code>-eq</code> <code>$null</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Try</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Credentials</code> <code>= </code><code>Get-Credential</code> <code>"domain\$env:username"</code> <code>-ErrorAction</code> <code>Stop</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Catch</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$ErrorMsg</code> <code>= </code><code>$_</code><code>.Exception.Message</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Warning</code> <code>"Failed to validate credentials: $ErrorMsg "</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Pause</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Break</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Try</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Username</code> <code>= </code><code>$credentials</code><code>.username</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Password</code> <code>= </code><code>$credentials</code><code>.GetNetworkCredential().password</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Root</code> <code>= </code><code>"LDAP://"</code> <code>+ (</code><code>[ADSI]</code><code>''</code><code>).distinguishedName</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Domain</code> <code>= </code><code>New-Object</code> <code>System.DirectoryServices.DirectoryEntry(</code><code>$Root</code><code>,</code><code>$UserName</code><code>,</code><code>$Password</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Catch</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$_</code><code>.Exception.Message</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Continue</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(!</code><code>$domain</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Write-Warning</code> <code>"Something went wrong"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Else</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code> <code>(</code><code>$domain</code><code>.name </code><code>-ne</code> <code>$null</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>"Authenticated"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Else</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>return</code> <code>"Not authenticated"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>}</code></p></div></td></tr></tbody></table>