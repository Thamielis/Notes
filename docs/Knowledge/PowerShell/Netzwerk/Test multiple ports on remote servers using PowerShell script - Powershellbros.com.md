![](Test%20multiple%20ports%20on%20remote%20servers%20using%20PowerShell%20script%20-%20Powershellbros.com/Windows_Firewall-1.png)

Some time ago I added articles about testing connection on several ports. In one of them I was explaining how to format [PortQry](https://www.powershellbros.com/use-powershell-to-format-port-query-portqry-output/) results and other was about [PowerShell function](https://www.powershellbros.com/test-connection-to-servers-on-several-ports/). This time I wanted to speed up things a little bit üôÇ

**Testing connection**

We can test connection in several ways. In this case I wanted to make a test on lots of remote machines in fast way. In this example I would like to show you how test multiple ports inside one scriptblock.

For purpose of this script I will test below ports ‚Äì **[Domains and Trusts](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770299(v=ws.10))**:

*   RPC ‚Äú135‚Äù
*   LDAP ‚Äú389‚Äù
*   LDAP ‚Äú636‚Äù
*   LDAP ‚Äú3268‚Äù
*   LDAP ‚Äú3269‚Äù
*   DNS ‚Äú53‚Äù
*   Kerberos ‚Äú88‚Äù
*   SMB ‚Äú445‚Äù

Below you can find script which will use **[Test-NetConnection](https://www.powershellbros.com/tag/test-netconnection/)** and add results to an array. This is nothing new apart from that it will check it faster than in previous examples:

<table><tbody><tr><td><p>1</p><p>2</p><p>3</p><p>4</p><p>5</p><p>6</p><p>7</p><p>8</p><p>9</p><p>10</p><p>11</p><p>12</p><p>13</p><p>14</p><p>15</p><p>16</p><p>17</p><p>18</p><p>19</p><p>20</p><p>21</p><p>22</p><p>23</p><p>24</p><p>25</p><p>26</p><p>27</p></td><td><div><p><code>$Servers</code> <code>= </code><code>"ADSO01"</code><code>,</code><code>"ADFS02"</code></p><p><code>$Ports</code>&nbsp;&nbsp; <code>=&nbsp; </code><code>"135"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"389"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"636"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"3268"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"3269"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"53"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"88"</code><code>,</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>"445"</code></p><p><code>$Destination</code> <code>= </code><code>"DC01"</code></p><p><code>$Results</code> <code>= @()</code></p><p><code>$Results</code> <code>= </code><code>Invoke-Command</code> <code>$Servers</code> <code>{</code><code>param</code><code>(</code><code>$Destination</code><code>,</code><code>$Ports</code><code>)</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>= </code><code>New-Object</code> <code>PSCustomObject</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"ServerName"</code> <code>-Value</code> <code>$env:COMPUTERNAME</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>-MemberType</code> <code>NoteProperty</code> <code>-Name</code> <code>"Destination"</code> <code>-Value</code> <code>$Destination</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Foreach</code> <code>(</code><code>$P</code> <code>in</code> <code>$Ports</code><code>){</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$PortCheck</code> <code>= (</code><code>Test-NetConnection</code> <code>-Port</code> <code>$p</code> <code>-ComputerName</code> <code>$Destination</code> <code>).TcpTestSucceeded</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>If</code><code>(</code><code>$PortCheck</code> <code>-notmatch</code> <code>"True|False"</code><code>){</code><code>$PortCheck</code> <code>= </code><code>"ERROR"</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code> <code>| </code><code>Add-Member</code> <code>Noteproperty </code><code>"$("</code><code>Port </code><code>" + "</code><code>$p</code><code>")"</code> <code>-Value</code> <code>"$($PortCheck)"</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>$Object</code></p><p><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code> <code>-ArgumentList</code> <code>$Destination</code><code>,</code><code>$Ports</code> <code>| select *</code> <code>-ExcludeProperty</code> <code>runspaceid, pscomputername</code></p><p><code>$Results</code> <code>| </code><code>Out-GridView</code> <code>-Title</code> <code>"Testing Ports"</code></p><p><code>$Results</code> <code>| </code><code>Format-Table</code> <code>-AutoSize</code></p></div></td></tr></tbody></table>

**Final results:**

![Multiple ports - results](Test%20multiple%20ports%20on%20remote%20servers%20using%20PowerShell%20script%20-%20Powershellbros.com/ports.png)